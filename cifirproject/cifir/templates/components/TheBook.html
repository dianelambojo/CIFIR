<div class="btn book-btn" name="book_id" value="{{book.id}}">
  <div class="dropdown">
    <a
      class="btn"
      href="#"
      role="button"
      id="dropdownMenuLink"
      data-toggle="dropdown"
      aria-haspopup="true"
      aria-expanded="false"
    >
      <i class="fas fa-ellipsis-v"></i>
    </a>

    <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
      <a
        class="dropdown-item"
        onclick="updateBook('{{ request.path }}' ,'favorite', '{{book.id}}')"
      >
        Favorite
      </a>
      <a
        class="dropdown-item"
        onclick="updateBook('{{ request.path }}' ,'to-read', '{{book.id}}')"
      >
        Add to To Read Books
      </a>
      <a
        class="dropdown-item"
        onclick="updateBook('{{ request.path }}' ,'have-read', '{{book.id}}')"
      >
        Add to Have Read
      </a>
    </div>
  </div>

  <div onclick="openBook('{{book.id}}', '{{book.file.url}}')">
    <div class="i-folders">
      <i class="fas fa-book"></i>
    </div>
    <div class="book-title">
      <h6>{{ book.title }}</h6>
    </div>
  </div>
</div>

{% block extrascriptfooter %}
<script>
  // source: https://stackoverflow.com/questions/133925/javascript-post-request-like-a-form-submit

  function openBook(book_id, book_file) {
    post('{% url "cifir:epub_view" %}', {
      book_id,
      book_file,
      csrfmiddlewaretoken: "{{csrf_token}}",
    });
  }

  function updateBook(currentURL, item, book_id) {
    if (item === "favorite") {
      post(currentURL, {
        book_id,
        item: "favorite",
        csrfmiddlewaretoken: "{{csrf_token}}",
        updateBookStatus: "",
      });
    }
    if (item === "to-read") {
      post(currentURL, {
        book_id,
        item: "to-read",
        csrfmiddlewaretoken: "{{csrf_token}}",
        updateBookStatus: "",
      });
    }
    if (item === "have-read") {
      post(currentURL, {
        book_id,
        item: "have-read",
        csrfmiddlewaretoken: "{{csrf_token}}",
        updateBookStatus: "",
      });
    }
  }

  function post(path, params, method = "post") {
    const form = document.createElement("form");
    form.method = method;
    form.action = path;

    for (const key in params) {
      if (params.hasOwnProperty(key)) {
        const hiddenField = document.createElement("input");
        hiddenField.type = "hidden";
        hiddenField.name = key;
        hiddenField.value = params[key];

        form.appendChild(hiddenField);
      }
    }
    document.body.appendChild(form);
    form.submit();
  }
</script>

{% endblock extrascriptfooter %}
